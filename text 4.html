<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2D Animation Studio — by: SmileMv</title>
  <style>
    :root{
      --pink:#ff99cc; --pink2:#ffd1e6; --pink3:#ffe6f2; --ink:#222;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:system-ui, Arial, sans-serif; background:var(--pink3); color:var(--ink);
      display:flex; flex-direction:column; align-items:center; gap:14px; padding:12px;
      -webkit-user-select:none; user-select:none; touch-action:none;
    }
    header{ width:100%; max-width:980px; background:var(--pink); color:#fff; padding:12px 16px; border-radius:16px; box-shadow:0 8px 20px rgba(0,0,0,.08); }
    header h1{ margin:0; font-size:20px; display:flex; align-items:center; justify-content:space-between }
    header small{ opacity:.9 }

    .panel{ width:100%; max-width:980px; background:#fff; border:2px solid var(--pink2); border-radius:16px; box-shadow:0 8px 20px rgba(0,0,0,.06); padding:12px; }
    .toolbar{ display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:center; }
    .toolbar .group{ display:flex; gap:8px; align-items:center; background:var(--pink3); padding:8px; border-radius:12px; border:1px solid var(--pink2); }
    button{ padding:10px 12px; border-radius:10px; border:0; background:var(--pink2); cursor:pointer; font-weight:600 }
    button.primary{ background:var(--pink); color:#fff }
    button.danger{ background:#ff6b81; color:#fff }
    button:disabled{ opacity:.6; cursor:not-allowed }
    input[type="number"]{ width:72px; padding:8px; border-radius:10px; border:1px solid var(--pink2); background:#fff }
    input[type="color"]{ width:40px; height:40px; border-radius:8px; border:1px solid var(--pink2); padding:0 }

    .stageWrap{ position:relative; width:100%; display:flex; justify-content:center; }
    canvas{ background:#fff; border:2px solid var(--pink2); border-radius:12px; box-shadow:0 6px 16px rgba(0,0,0,.05); touch-action:none }
    .meta{ display:flex; gap:12px; justify-content:center; margin-top:8px; font-weight:600 }
    footer{ color:#777 }
  </style>
</head>
<body>
  <header>
    <h1>
      2D Animation Studio
      <small>by: <b>SmileMv</b></small>
    </h1>
  </header>

  <div class="panel">
    <div class="toolbar">
      <div class="group">
        <label>Warna</label>
        <input id="color" type="color" value="#000000"/>
      </div>
      <div class="group">
        <label>Ukuran</label>
        <input id="size" type="number" value="6" min="1" max="64"/>
        <button id="eraseBtn">Penghapus: OFF</button>
      </div>
      <div class="group">
        <label>FPS</label>
        <input id="fps" type="number" value="8" min="1" max="30"/>
        <button id="playBtn" class="primary">▶ Putar</button>
        <button id="stopBtn">■ Stop</button>
      </div>
      <div class="group">
        <button id="prevBtn">⟨ Frame Sebelumnya</button>
        <button id="nextBtn">Frame Berikutnya ⟩</button>
        <button id="addBtn" class="primary">+ Tambah Frame</button>
        <button id="dupBtn">⎘ Duplikat Frame</button>
        <button id="delBtn" class="danger">✕ Hapus Frame</button>
      </div>
    </div>

    <div class="stageWrap">
      <canvas id="stage" width="960" height="540"></canvas>
    </div>

    <div class="meta">
      <div>Frame: <span id="frameIndex">1</span>/<span id="frameTotal">1</span></div>
      <div>Mode: <span id="modeLabel">Pena</span></div>
    </div>
  </div>

  <footer>Tips: gesek jari/mouse untuk menggambar. Gunakan tombol "Tambah Frame" untuk animasi bertahap.</footer>

  <script>
    // --- Canvas setup dengan dukungan mobile ---
    const canvas = document.getElementById('stage');
    const ctx = canvas.getContext('2d');

    // Retina scaling untuk hasil tajam
    const DPR = Math.max(1, window.devicePixelRatio || 1);
    const baseW = canvas.width, baseH = canvas.height;
    canvas.width = baseW * DPR; canvas.height = baseH * DPR; canvas.style.width = baseW + 'px'; canvas.style.height = baseH + 'px';
    ctx.scale(DPR, DPR);

    // --- State ---
    let frames = [null]; // setiap item: dataURL atau null (kosong)
    let current = 0;
    let drawing = false;
    let isEraser = false;

    // UI elements
    const colorEl = document.getElementById('color');
    const sizeEl = document.getElementById('size');
    const fpsEl = document.getElementById('fps');
    const playBtn = document.getElementById('playBtn');
    const stopBtn = document.getElementById('stopBtn');
    const addBtn = document.getElementById('addBtn');
    const dupBtn = document.getElementById('dupBtn');
    const delBtn = document.getElementById('delBtn');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const eraseBtn = document.getElementById('eraseBtn');
    const frameIndex = document.getElementById('frameIndex');
    const frameTotal = document.getElementById('frameTotal');
    const modeLabel = document.getElementById('modeLabel');

    // --- Helpers ---
    function getPos(ev){
      const rect = canvas.getBoundingClientRect();
      let x, y;
      if (ev.touches && ev.touches[0]){ x = ev.touches[0].clientX; y = ev.touches[0].clientY; }
      else if (ev.changedTouches && ev.changedTouches[0]){ x = ev.changedTouches[0].clientX; y = ev.changedTouches[0].clientY; }
      else { x = ev.clientX; y = ev.clientY; }
      return { x: (x - rect.left), y: (y - rect.top) };
    }
    function saveFrame(){ frames[current] = canvas.toDataURL('image/png'); updateMeta(); }
    function loadFrame(i=current){
      ctx.clearRect(0,0,baseW,baseH);
      const data = frames[i];
      if (!data) return; // kosong
      const img = new Image();
      img.onload = ()=>{ ctx.clearRect(0,0,baseW,baseH); ctx.drawImage(img,0,0,baseW,baseH); };
      img.src = data;
    }
    function updateMeta(){ frameIndex.textContent = (current+1); frameTotal.textContent = frames.length; modeLabel.textContent = isEraser? 'Penghapus' : 'Pena'; }

    // --- Drawing ---
    function startDraw(ev){ ev.preventDefault(); drawing = true; const p = getPos(ev); ctx.beginPath(); ctx.moveTo(p.x, p.y); }
    function moveDraw(ev){ if (!drawing) return; ev.preventDefault(); const p = getPos(ev); ctx.lineJoin='round'; ctx.lineCap='round'; ctx.lineWidth = Math.max(1, +sizeEl.value||1); if(isEraser){ ctx.globalCompositeOperation='destination-out'; } else { ctx.globalCompositeOperation='source-over'; ctx.strokeStyle = colorEl.value; } ctx.lineTo(p.x, p.y); ctx.stroke(); ctx.moveTo(p.x, p.y); }
    function endDraw(ev){ if(!drawing) return; ev.preventDefault(); drawing = false; ctx.closePath(); saveFrame(); }

    // Mouse
    canvas.addEventListener('mousedown', startDraw);
    canvas.addEventListener('mousemove', moveDraw);
    window.addEventListener('mouseup', endDraw);
    // Touch
    canvas.addEventListener('touchstart', startDraw, {passive:false});
    canvas.addEventListener('touchmove', moveDraw, {passive:false});
    window.addEventListener('touchend', endDraw, {passive:false});

    // --- Frame Controls ---
    addBtn.onclick = ()=>{ frames.splice(current+1,0,null); current++; ctx.clearRect(0,0,baseW,baseH); updateMeta(); };
    dupBtn.onclick = ()=>{ const copy = frames[current]; frames.splice(current+1,0,copy); current++; loadFrame(); };
    delBtn.onclick = ()=>{ if(frames.length===1){ ctx.clearRect(0,0,baseW,baseH); frames[0]=null; saveFrame(); return; } frames.splice(current,1); current = Math.max(0, current-1); loadFrame(); updateMeta(); };
    prevBtn.onclick = ()=>{ if(current>0){ current--; loadFrame(); updateMeta(); }};
    nextBtn.onclick = ()=>{ if(current<frames.length-1){ current++; loadFrame(); updateMeta(); }};

    // Play/Stop
    let playTimer = null;
    playBtn.onclick = ()=>{
      if(playTimer) return; // already playing
      const fps = Math.max(1, Math.min(60, +fpsEl.value||8));
      let i = 0;
      playTimer = setInterval(()=>{
        const idx = i % frames.length;
        current = idx; updateMeta(); loadFrame(idx);
        i++;
      }, 1000 / fps);
    };
    stopBtn.onclick = ()=>{ if(playTimer){ clearInterval(playTimer); playTimer = null; } };

    // Eraser toggle
    eraseBtn.onclick = ()=>{ isEraser = !isEraser; eraseBtn.textContent = 'Penghapus: ' + (isEraser? 'ON' : 'OFF'); updateMeta(); };

    // Init
    ctx.lineWidth = +sizeEl.value; ctx.strokeStyle = colorEl.value; updateMeta(); saveFrame();
  </script>
</body>
</html>
